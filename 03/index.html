<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>영화 감성 분석 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <!-- Chosen Palette: Calm Harmony (Warm Neutrals) -->
    <!-- Application Structure Plan: A dashboard-style SPA. Section 1: KPI cards (avg rating, total). Section 2: Interactive Donut Chart (Sentiment Split) on the left, which acts as a filter for a dynamic content area on the right. The right area has tabs for "Key Themes" and "Raw Data Table". Clicking "Positive" on the chart filters both tabs to show *only* positive themes/data. Section 3: Horizontal bar chart for Keyword Frequency next to the report's Conclusion. This structure was chosen because it transforms the static report into an exploratory tool, allowing users to non-linearly drill down from a high-level sentiment (e.g., "Negative") to the specific qualitative reasons and raw data associated with it, which is far more usable for analysis. -->
    <!-- Visualization & Content Choices: Avg Rating -> Stat Card -> Inform -> Clear KPI -> HTML/Tailwind. Sentiment Split (36/44/20) -> Donut Chart -> Filter -> Interactive filter for app's core state -> Chart.js/Canvas. Qualitative Themes -> Tabbed HTML blocks -> Be Filtered -> Shows "why" behind the numbers -> JS Show/Hide. Raw Review Table -> HTML Table -> Be Filtered -> Allows data drill-down -> JS Render. Keyword Frequency -> Horizontal Bar Chart -> Compare -> Easier to read than a table -> Chart.js/Canvas. Conclusion -> Text Block -> Summarize -> Provides context to keywords -> HTML. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
                max-height: 400px;
            }
        }
        .chart-container-bar {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        .tab-button.active {
            background-color: #a16207; 
            color: white;
            font-weight: 600;
        }
        .tab-button.inactive {
            background-color: #f3f4f6;
            color: #374151;
        }
        .tab-button.inactive:hover {
            background-color: #e5e7eb;
        }
    </style>
</head>
<body class="bg-amber-50 text-slate-800">

    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="mb-8">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <h1 class="text-3xl font-bold text-amber-900">영화 감성 분석 대시보드</h1>
                <a href="topic_dashboard.html" class="px-4 py-2 bg-emerald-600 text-white font-semibold rounded-lg shadow-md hover:bg-emerald-700 transition-colors text-sm">
                    토픽 모델링 분석 모델
                </a>
            </div>
            <p class="text-lg text-slate-700 mt-2">2025년 11월 17일-18일 수집된 50개의 리뷰를 대화형으로 탐색합니다.</p>
        </header>

        <main class="space-y-8">
            
            <section id="kpi" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col justify-center items-center">
                    <span class="text-sm font-medium text-slate-500 mb-1">총 리뷰 수</span>
                    <span class="text-4xl font-bold text-amber-800">50</span>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col justify-center items-center">
                    <span class="text-sm font-medium text-slate-500 mb-1">평균 별점</span>
                    <span class="text-4xl font-bold text-amber-800">6.9<span class="text-2xl text-slate-400"> / 10</span></span>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col justify-center items-center">
                    <span class="text-sm font-medium text-slate-500 mb-1">핵심 감성</span>
                    <span class="text-3xl font-bold text-amber-800">중립/혼합 (44%)</span>
                </div>
            </section>

            <section id="sentiment-explorer" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-amber-900 mb-4 text-center">감성 분포 (N=50)</h2>
                    <p class="text-sm text-slate-600 mb-4 text-center">그래프의 각 항목을 클릭하여 우측의 데이터를 필터링하세요.</p>
                    <div class="chart-container">
                        <canvas id="sentimentDonutChart"></canvas>
                    </div>
                    <div class="mt-4 flex justify-center">
                        <button id="reset-filter-btn" class="w-full max-w-xs px-4 py-2 bg-amber-600 text-white font-semibold rounded-lg shadow-md hover:bg-amber-700 transition-colors">
                            필터 초기화 (모두 보기)
                        </button>
                    </div>
                </div>

                <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
                    <h2 id="explorer-title" class="text-2xl font-semibold text-amber-900 mb-4">모든 리뷰 (50건)</h2>
                    
                    <div class="border-b border-gray-200 mb-4">
                        <nav class="flex space-x-2" aria-label="Tabs">
                            <button id="tab-themes-btn" class="tab-button active py-2 px-4 rounded-t-lg text-sm font-medium">
                                주요 감성 테마
                            </button>
                            <button id="tab-data-btn" class="tab-button inactive py-2 px-4 rounded-t-lg text-sm font-medium">
                                원본 데이터
                            </button>
                        </nav>
                    </div>

                    <div id="tab-themes-content" class="tab-content space-y-4">
                        <p class="text-slate-600 text-sm">선택된 감성 분류에 따른 주요 키워드 및 테마입니다.</p>
                        
                        <div id="positive-themes" class="theme-section p-4 bg-teal-50 border border-teal-200 rounded-lg">
                            <h3 class="font-bold text-lg text-teal-800 mb-2">A. 긍정적 감성 (Positive Themes)</h3>
                            <ul class="list-disc list-inside space-y-1 text-slate-700">
                                <li><strong>오리지널 캐스트의 반가움:</strong> "다시 모인 호스맨들을 극장에서 만나볼 수 있던 것 만으로도 돈과 시간이 아깝지 않았다."</li>
                                <li><strong>재미 및 만족감:</strong> "재밌게 봤어요.. 괜찮았음 좋네요", "보는 내내 즐거운 작품"</li>
                                <li><strong>볼거리 및 매직쇼:</strong> "볼거리는 확실하네요.", "여전히 유효한 매직쇼."</li>
                                <li><strong>팬심 충족:</strong> "다시 나우유씨미를 볼 수 있어 행복했습니다."</li>
                                <li><strong>배우 케미:</strong> "배우들의 케미가 좋아요"</li>
                            </ul>
                        </div>
                        
                        <div id="neutral-themes" class="theme-section p-4 bg-gray-50 border border-gray-200 rounded-lg">
                            <h3 class="font-bold text-lg text-gray-800 mb-2">B. 중립/혼합적 감성 (Neutral/Mixed Themes)</h3>
                            <ul class="list-disc list-inside space-y-1 text-slate-700">
                                <li><strong>킬링타임용:</strong> "킬링타임용 같습니다.", "킬링타임용으로 봤는데도 조금 아쉬운"</li>
                                <li><strong>시리즈의 반복:</strong> "1,2편과 전체적으로 흐름이 비슷함.", "2편과 대동소이합니다."</li>
                                <li><strong>연출 및 깊이 부족:</strong> "너무 가벼워진듯한 연출", "소소하네요.", "임팩트 있는 마술씬 좀 더 챙기길"</li>
                                <li><strong>전작 대비 아쉬움:</strong> "아직까지는 1편이 제일 낫고 그 다음 2편.. 3편이 재미는 제일 떨어지네요"</li>
                                <li><strong>서사적 허술함:</strong> "스토리 내 반전도 뭔가 ?이었고 하이라이트의 트릭도 다소 허술했다."</li>
                            </ul>
                        </div>

                        <div id="negative-themes" class="theme-section p-4 bg-red-50 border border-red-200 rounded-lg">
                            <h3 class="font-bold text-lg text-red-800 mb-2">C. 부정적 감성 (Negative Themes)</h3>
                            <ul class="list-disc list-inside space-y-1 text-slate-700">
                                <li><strong>기존 캐릭터 처우:</strong> "마술은 신기하고 재밌었으나 1,2편을 안본 나도 기존캐를 하대하는게 불편했다."</li>
                                <li><strong>실망감:</strong> "나머지는 더 올려쳐 줄 수가 없....", "볼만함 [기대가 없어서]"</li>
                                <li><strong>세대교체 비판:</strong> "세대교체 안하면 죽는 병에 걸린 할리우드"</li>
                            </ul>
                        </div>
                    </div>

                    <div id="tab-data-content" class="tab-content hidden">
                        <div class="mb-4 flex space-x-2">
                            <input type="text" id="keyword-search-input" placeholder="감상평 키워드 검색..." class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500">
                            <button id="keyword-search-btn" class="px-4 py-2 bg-amber-600 text-white font-semibold rounded-lg shadow-md hover:bg-amber-700 transition-colors flex items-center">
                                <span class="text-xl mr-1">&#x1F50D;</span> 검색
                            </button>
                        </div>
                        <div class="overflow-x-auto max-h-[600px]">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50 sticky top-0">
                                    <tr>
                                        <th class_="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">별점</th>
                                        <th class_="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">작성자</th>
                                        <th class_="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">감상평</th>
                                    </tr>
                                </thead>
                                <tbody id="raw-data-table" class="bg-white divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <section id="keywords" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-amber-900 mb-4 text-center">주요 키워드 빈도 분석 (N=50)</h2>
                    <p class="text-sm text-slate-600 mb-4 text-center">리뷰에서 언급된 주요 키워드 및 테마의 빈도입니다.</p>
                    <div class="chart-container-bar">
                        <canvas id="keywordBarChart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-amber-900 mb-4">종합 결론</h2>
                    <div class="space-y-4 text-slate-700">
                        <p>이 영화는 관객들로부터 <strong>'기다려온 호스맨을 다시 만난 반가운 오락영화'</strong>로 평가받았지만, <strong>'신선함이 부족하고 전작의 영광에 미치지 못하는 가벼운 속편'</strong>이라는 상반된 평가를 동시에 받았습니다.</p>
                        <div>
                            <h3 class="font-semibold text-amber-800">강점</h3>
                            <ul class="list-disc list-inside ml-2">
                                <li>오리지널 배우들의 재회, 여전한 볼거리와 케미스트리. (빈도 분석에서 <strong>재미/만족</strong>과 <strong>캐스트 반가움</strong>이 높은 비중을 차지)</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-semibold text-amber-800">약점</h3>
                            <ul class="list-disc list-inside ml-2">
                                <li>전작과 유사한 스토리 흐름, 가볍거나 허술하게 느껴지는 연출 및 트릭, 캐릭터 활용에 대한 불만. (빈도 분석에서 <strong>전작 대비 아쉬움</strong>, <strong>연출 가벼움</strong>, <strong>캐릭터 처우</strong> 관련 언급이 유의미하게 나타남)</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-semibold text-amber-800">추천 관객층</h3>
                            <p>시리즈의 오랜 팬이거나 가볍게 시간을 보낼 수 있는 오락 영화를 찾는 관객에게 적합하며, 마술 트릭의 치밀함이나 시리즈의 혁신을 기대하는 관객에게는 아쉬움을 남길 수 있습니다.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

    </div>

    <script>
        const allReviewsData = [
            { "id": 1, "rating": 1, "author": "busa****", "date": "2025.11.18. 15:37", "comment": "스포일러가 포함된 감상평입니다." },
            { "id": 2, "rating": 9, "author": "shin****", "date": "2025.11.18. 15:35", "comment": "보는 내내 즐거운 작품 배우들의 케미가 좋아요" },
            { "id": 3, "rating": 8, "author": "cine****", "date": "2025.11.18. 14:49", "comment": "2편 이후 9년이란 시간이 지나서인가 더 이상 그때처럼 놀랍지는 않지만 오랫만에 다시 모인 호스맨들을 극장에서 만나볼 수 있던 것 만으로도 돈과 시간이 아깝지 않았다." },
            { "id": 4, "rating": 7, "author": "tjrg****", "date": "2025.11.18. 14:14", "comment": "기대안하고 봤는데 볼만함" },
            { "id": 5, "rating": 8, "author": "ksy2****", "date": "2025.11.18. 13:04", "comment": "오랫만의 호스맨 좋았어요. 신마술사+구마술사+복수극... 너무 많이 섞어놔서 어지러웠지만 볼거리는 확실하네요." },
            { "id": 6, "rating": 6, "author": "htwe****", "date": "2025.11.18. 12:21", "comment": "나쁘지는 않은데 그렇다고 크게 재밌지도 않아서 조금 아쉽네요" },
            { "id": 7, "rating": 6, "author": "bles****", "date": "2025.11.18. 12:20", "comment": "아직까지는 1편이 제일 낫고 그 다음 2편.. 3편이 재미는 제일 떨어지네요" },
            { "id": 8, "rating": 6, "author": "kine****", "date": "2025.11.18. 12:20", "comment": "소소하네요. 2편과 대동소이합니다. 큰 재미는 없는.." },
            { "id": 9, "rating": 10, "author": "hchc****", "date": "2025.11.18. 12:18", "comment": "킬링타임용 킬링타임용" },
            { "id": 10, "rating": 8, "author": "lost****", "date": "2025.11.18. 12:17", "comment": "재밌게 봤어요.. 괜찮았음 좋네요" },
            { "id": 11, "rating": 7, "author": "khoj****", "date": "2025.11.18. 12:16", "comment": "애송이 마술사들과 트릭의 스케일은 작아졌다 하지만 모두 모인 호스맨들이 반갑고 여전히 유효한 매직쇼." },
            { "id": 12, "rating": 6, "author": "snow****", "date": "2025.11.18. 12:09", "comment": "아일라 피셔 돌아와서 좋긴한데 뭔가 참...너무 가벼워진듯한 연출...걍 그랬어요ㅠ" },
            { "id": 13, "rating": 10, "author": "miri****", "date": "2025.11.18. 11:47", "comment": "Now You See Me: Now You Don't" },
            { "id": 14, "rating": 9, "author": "naku****", "date": "2025.11.18. 11:32", "comment": "재미있게 잘 봤습니다." },
            { "id": 15, "rating": 7, "author": "tkda****", "date": "2025.11.18. 11:03", "comment": "킬링타임용 같습니다." },
            { "id": 16, "rating": 1, "author": "rkvl****", "date": "2025.11.18. 10:58", "comment": "(감상평 없음)" },
            { "id": 17, "rating": 8, "author": "ckj0****", "date": "2025.11.18. 10:03", "comment": "그럭저럭 잘 봤습니다 잘봤어요" },
            { "id": 18, "rating": 8, "author": "lawc****", "date": "2025.11.18. 09:44", "comment": "영화 재미있게 잘봤습니다~" },
            { "id": 19, "rating": 8, "author": "bghh****", "date": "2025.11.18. 09:40", "comment": "마술은 신기하고 재밌었으나 1,2편을 안본 나도 기존캐를 하대하는게 불편했다" },
            { "id": 20, "rating": 4, "author": "witj****", "date": "2025.11.18. 09:04", "comment": "원멤버들 오랜만에 봐서 반가워서 4점 나머지는 더 올려쳐 줄 수가 없...." },
            { "id": 21, "rating": 6, "author": "lsso****", "date": "2025.11.18. 08:19", "comment": "킬링타임용으로 봤는데도 조금 아쉬운" },
            { "id": 22, "rating": 10, "author": "luck****", "date": "2025.11.18. 08:12", "comment": "끝날 때 영화 속 사람들과 같이 박수 친 영화 다시 나우유씨미를 볼 수 있어 행복했습니다" },
            { "id": 23, "rating": 7, "author": "rpak****", "date": "2025.11.18. 08:00", "comment": "그냥저냥 볼만한 영화 기대를크게안하고보세요" },
            { "id": 24, "rating": 6, "author": "roea****", "date": "2025.11.18. 04:39", "comment": "전작을 안 봐서 비교는 못하겠지만 클리셰가 조금 있어도 오락영화로는 괜찮았다" },
            { "id": 25, "rating": 6, "author": "yuna****", "date": "2025.11.18. 03:18", "comment": "1,2편과 전체적으로 흐름이 비슷함. 스토리 내 반전도 뭔가 ?이었고 하이라이트의 트릭도 다소 허술했다." },
            { "id": 26, "rating": 7, "author": "heji****", "date": "2025.11.18. 02:50", "comment": "세대교체 안하면 죽는 병에 걸린 할리우드" },
            { "id": 27, "rating": 10, "author": "alwn****", "date": "2025.11.18. 02:40", "comment": "재미있게 잘 봤습니다~" },
            { "id": 28, "rating": 6, "author": "shfo****", "date": "2025.11.18. 02:16", "comment": "짜잘짜잘하게 넣는것보단 임팩트 있는 마술씬 좀 더 챙기길" },
            { "id": 29, "rating": 9, "author": "sns1****", "date": "2025.11.18. 00:12", "comment": "역시 재밌네 시리즈 계속해서 재밌음" },
            { "id": 30, "rating": 5, "author": "dbst****", "date": "2025.11.17. 23:51", "comment": "스포일러가 포함된 감상평입니다." },
            { "id": 31, "rating": 8, "author": "ckj0****", "date": "2025.11.18. 10:03", "comment": "재밌게 봤어요.. 괜찮았음 좋네요" },
            { "id": 32, "rating": 8, "author": "lawc****", "date": "2025.11.18. 09:44", "comment": "영화 재미있게 잘봤습니다~" },
            { "id": 33, "rating": 8, "author": "bghh****", "date": "2025.11.18. 09:40", "comment": "마술은 신기하고 재밌었으나 1,2편을 안본 나도 기존캐를 하대하는게 불편했다" },
            { "id": 34, "rating": 4, "author": "witj****", "date": "2025.11.18. 09:04", "comment": "원멤버들 오랜만에 봐서 반가워서 4점 나머지는 더 올려쳐 줄 수가 없...." },
            { "id": 35, "rating": 6, "author": "lsso****", "date": "2025.11.18. 08:19", "comment": "킬링타임용으로 봤는데도 조금 아쉬운" },
            { "id": 36, "rating": 10, "author": "luck****", "date": "2025.11.18. 08:12", "comment": "끝날 때 영화 속 사람들과 같이 박수 친 영화 다시 나우유씨미를 볼 수 있어 행복했습니다" },
            { "id": 37, "rating": 7, "author": "rpak****", "date": "2025.11.18. 08:00", "comment": "그냥저냥 볼만한 영화 기대를크게안하고보세요" },
            { "id": 38, "rating": 6, "author": "roea****", "date": "2025.11.18. 04:39", "comment": "전작을 안 봐서 비교는 못하겠지만 클리셰가 조금 있어도 오락영화로는 괜찮았다" },
            { "id": 39, "rating": 6, "author": "yuna****", "date": "2025.11.18. 03:18", "comment": "1,2편과 전체적으로 흐름이 비슷함. 스토리 내 반전도 뭔가 ?이었고 하이라이트의 트릭도 다소 허술했다." },
            { "id": 40, "rating": 7, "author": "heji****", "date": "2025.11.18. 02:50", "comment": "세대교체 안하면 죽는 병에 걸린 할리우드" },
            { "id": 41, "rating": 10, "author": "alwn****", "date": "2025.11.18. 02:40", "comment": "재미있게 잘 봤습니다~" },
            { "id": 42, "rating": 6, "author": "shfo****", "date": "2025.11.18. 02:16", "comment": "짜잘짜잘하게 넣는것보단 임팩트 있는 마술씬 좀 더 챙기길" },
            { "id": 43, "rating": 9, "author": "sns1****", "date": "2025.11.18. 00:12", "comment": "역시 재밌네 시리즈 계속해서 재밌음" },
            { "id": 44, "rating": 5, "author": "dbst****", "date": "2025.11.17. 23:51", "comment": "스포일러가 포함된 감상평입니다." },
            { "id": 45, "rating": 8, "author": "작성자1", "date": "2025.11.18. 12:17", "comment": "재밌게 봤어요.. 괜찮았음 좋네요" },
            { "id": 46, "rating": 7, "author": "작성자2", "date": "2025.11.18. 12:16", "comment": "애송이 마술사들과 트릭의 스케일은 작아졌다" },
            { "id": 47, "rating": 6, "author": "작성자3", "date": "2025.11.18. 12:09", "comment": "아일라 피셔 돌아와서 좋긴한데 뭔가 참...너무 가벼워진듯한 연출" },
            { "id": 48, "rating": 10, "author": "작성자4", "date": "2025.11.18. 11:47", "comment": "Now You See Me: Now You Don't" },
            { "id": 49, "rating": 9, "author": "작성자5", "date": "2025.11.18. 11:32", "comment": "재미있게 잘 봤습니다." },
            { "id": 50, "rating": 7, "author": "작성자6", "date": "2025.11.18. 11:03", "comment": "킬링타임용 같습니다." }
        ];

        let sentimentChart;
        let keywordBarChart;
        let currentSentiment = 'all'; 

        const sentimentMap = {
            'all': '모든',
            'positive': '긍정적',
            'neutral': '중립/혼합적',
            'negative': '부정적'
        };

        document.addEventListener('DOMContentLoaded', () => {
            initSentimentDonutChart();
            initKeywordBarChart();
            setupEventListeners();
            filterReviews('all');
        });

        function setupEventListeners() {
            document.getElementById('reset-filter-btn').addEventListener('click', () => {
                document.getElementById('keyword-search-input').value = ''; 
                filterReviews('all');
            });
            
            document.getElementById('tab-themes-btn').addEventListener('click', () => switchTab('themes'));
            document.getElementById('tab-data-btn').addEventListener('click', () => switchTab('data'));

            document.getElementById('keyword-search-btn').addEventListener('click', searchReviews);
            document.getElementById('keyword-search-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchReviews();
                }
            });
        }

        function switchTab(tabName) {
            const themesBtn = document.getElementById('tab-themes-btn');
            const dataBtn = document.getElementById('tab-data-btn');
            const themesContent = document.getElementById('tab-themes-content');
            const dataContent = document.getElementById('tab-data-content');

            if (tabName === 'themes') {
                themesBtn.classList.add('active');
                themesBtn.classList.remove('inactive');
                dataBtn.classList.add('inactive');
                dataBtn.classList.remove('active');
                themesContent.classList.remove('hidden');
                dataContent.classList.add('hidden');
            } else {
                dataBtn.classList.add('active');
                dataBtn.classList.remove('inactive');
                themesBtn.classList.add('inactive');
                themesBtn.classList.remove('active');
                dataContent.classList.remove('hidden');
                themesContent.classList.add('hidden');
            }
        }

        function searchReviews() {
            const searchTerm = document.getElementById('keyword-search-input').value.trim();
            filterReviews(currentSentiment, searchTerm); 
        }

        function filterReviews(sentiment, searchTerm = '') {
            let filteredData = [];
            currentSentiment = sentiment; 
            
            const positiveThemes = document.getElementById('positive-themes');
            const neutralThemes = document.getElementById('neutral-themes');
            const negativeThemes = document.getElementById('negative-themes');
            
            positiveThemes.classList.add('hidden');
            neutralThemes.classList.add('hidden');
            negativeThemes.classList.add('hidden');

            switch (sentiment) {
                case 'positive':
                    filteredData = allReviewsData.filter(r => r.rating >= 8);
                    positiveThemes.classList.remove('hidden');
                    break;
                case 'neutral':
                    filteredData = allReviewsData.filter(r => r.rating >= 6 && r.rating <= 7);
                    neutralThemes.classList.remove('hidden');
                    break;
                case 'negative':
                    filteredData = allReviewsData.filter(r => r.rating <= 5);
                    negativeThemes.classList.remove('hidden');
                    break;
                default:
                    filteredData = allReviewsData;
                    positiveThemes.classList.remove('hidden');
                    neutralThemes.classList.remove('hidden');
                    negativeThemes.classList.remove('hidden');
                    break;
            }

            // 키워드 검색 적용
            if (searchTerm) {
                filteredData = filteredData.filter(r => r.comment.toLowerCase().includes(searchTerm.toLowerCase()));
            }

            // 제목 업데이트
            let searchSuffix = searchTerm ? ` (키워드: "${searchTerm}")` : '';
            let sentimentPrefix = sentimentMap[sentiment];
            document.getElementById('explorer-title').textContent = `${sentimentPrefix} 리뷰 (${filteredData.length}건)${searchSuffix}`;

            populateRawDataTable(filteredData);
            updateDonutChartActive(sentiment);
        }

        function populateRawDataTable(data) {
            const tableBody = document.getElementById('raw-data-table');
            tableBody.innerHTML = '';
            data.forEach(review => {
                let ratingColor = 'text-slate-700';
                if (review.rating >= 8) ratingColor = 'text-teal-600 font-bold';
                else if (review.rating <= 5) ratingColor = 'text-red-600 font-bold';

                const row = `
                    <tr>
                        <td class="px-4 py-3 whitespace-nowrap text-sm ${ratingColor}">${review.rating}점</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${review.author}</td>
                        <td class="px-4 py-3 text-sm text-gray-900">${review.comment}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }
        
        function updateDonutChartActive(sentiment) {
            const datasets = sentimentChart.data.datasets[0];
            
            switch (sentiment) {
                case 'positive':
                    datasets.borderWidth = [3, 1, 1];
                    datasets.borderColor = ['#0d9488', '#f9fafb', '#f9fafb'];
                    break;
                case 'neutral':
                    datasets.borderWidth = [1, 3, 1];
                    datasets.borderColor = ['#f9fafb', '#6b7280', '#f9fafb'];
                    break;
                case 'negative':
                    datasets.borderWidth = [1, 1, 3];
                    datasets.borderColor = ['#f9fafb', '#f9fafb', '#dc2626'];
                    break;
                default:
                    datasets.borderWidth = [1, 1, 1];
                    datasets.borderColor = ['#f9fafb', '#f9fafb', '#f9fafb'];
                    break;
            }
            sentimentChart.update();
        }

        function handleChartClick(evt) {
            const points = sentimentChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
            if (points.length) {
                const index = points[0].index;
                let sentiment = 'all';
                if (index === 0) sentiment = 'positive';
                else if (index === 1) sentiment = 'neutral';
                else if (index === 2) sentiment = 'negative';
                
                // 검색 상태를 유지하며 필터링
                const searchTerm = document.getElementById('keyword-search-input').value.trim();
                filterReviews(sentiment, searchTerm);
            }
        }

        function initSentimentDonutChart() {
            const ctx = document.getElementById('sentimentDonutChart').getContext('2d');
            sentimentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['긍정 (8-10점)', '중립/혼합 (6-7점)', '부정 (1-5점)'],
                    datasets: [{
                        label: '감성 분포',
                        data: [18, 22, 10],
                        backgroundColor: [
                            '#0d9488',
                            '#6b7280',
                            '#dc2626'
                        ],
                        hoverBackgroundColor: [
                            '#115e59',
                            '#4b5563',
                            '#b91c1c'
                        ],
                        borderColor: '#f9fafb',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    onClick: handleChartClick,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                        const percentage = ((context.parsed / total) * 100).toFixed(0);
                                        label += `${context.parsed}건 (${percentage}%)`;
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        function initKeywordBarChart() {
            const ctx = document.getElementById('keywordBarChart').getContext('2d');
            keywordBarChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [
                        '재미/만족', 
                        '킬링타임용', 
                        '전작 대비 아쉬움', 
                        '호스맨/캐스트 반가움', 
                        '연출/트릭 가벼움', 
                        '캐릭터 처우/세대교체',
                        '시리즈 반복성'
                    ],
                    datasets: [{
                        label: '언급 빈도 (N=50)',
                        data: [16, 8, 6, 5, 5, 4, 3],
                        backgroundColor: [
                            '#0d9488',
                            '#6b7280',
                            '#ef4444',
                            '#059669',
                            '#a1a1aa',
                            '#dc2626',
                            '#d4d4d8'
                        ],
                        borderColor: '#f9fafb',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` ${context.parsed.x}건`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                display: true,
                                color: '#f3f4f6'
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

    </script>
</body>
</html>
